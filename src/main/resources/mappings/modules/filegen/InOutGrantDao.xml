<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.weichai.modules.filegen.dao.InOutGrantDao">
	<sql id="inOutGrantColumns">
		a.ID as id,
		a.CONTENT as content,
		a.ENCODES as encodes,
		a.SUPPLIER_TYPE as supplierType,
		a.FILE_PATH as filePath,
		a.CREATE_BY as createBy,
		a.CREATE_DATE as createDate,
		a.UPDATE_BY as updateBy,
		a.UPDATE_DATE as updateDate,
		a.REMARKS as remarks,
		a.STATUS as status
	</sql>

	<select id="countBatch"  resultType="java.lang.Integer" parameterType="java.lang.String">

		SELECT COUNT(1)
		FROM  IN_OUT_GRANT  a
		WHERE
		<![CDATA[
		  a.CREATE_DATE > trunc(sysdate) AND
		  a.CREATE_DATE < trunc(sysdate+1)
		]]>
		AND SUPPLIER_TYPE = #{type}

	</select>

	<insert id="insertInOutGrant" parameterType="InOutGrant">
		INSERT INTO IN_OUT_GRANT(
			ID,
			CONTENT,
			ENCODES,
			SUPPLIER_TYPE,
			FILE_PATH,
			CREATE_BY,
			CREATE_DATE,
			UPDATE_BY,
			UPDATE_DATE,
			REMARKS,
			STATUS
		)VALUES (
			#{id},
			#{content},
			#{encodes},
			#{supplierType},
			#{filePath},
			#{createBy},
			#{createDate},
			#{updateBy},
			#{updateDate},
			#{remarks},
			#{status}
		)
	</insert>

	<select id="selectInOutGrantCount" parameterType="InOutGrant" resultType="InOutGrant">
		SELECT
			SUPPLIER_TYPE as supplierType,
			count(1) as countBatch
		FROM IN_OUT_GRANT
		<where>
			<if test="supplierType!=null and supplierType!=''">
				SUPPLIER_TYPE = #{supplierType}
			</if>
			<if test="startTime !=null">
				<![CDATA[  AND  trunc(CREATE_DATE) >= #{startTime}  ]]>
			</if>
			<if test="endTime !=null">
				<![CDATA[  AND  trunc(CREATE_DATE) <= #{endTime}  ]]>
			</if>
		</where>
		GROUP BY SUPPLIER_TYPE
	</select>

	<update id="updateInOutGrantUrl" parameterType="InOutGrant">
		UPDATE IN_OUT_GRANT
		set FILE_PATH = #{filePath}
		WHERE SUPPLIER_TYPE = #{supplierType}
		AND FILE_PATH = #{originalFilePath}
	</update>
</mapper>

